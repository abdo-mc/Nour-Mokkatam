<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>التدريبات</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
    body { font-family: 'Cairo', sans-serif; margin:0; padding:0; background:#f9fafc; color:#222; display:flex; flex-direction:column; min-height:100vh; }
    header { background-color:#00529b; color:white; padding:15px 20px; font-size:1.9rem; font-weight:700; text-align:center; position:relative; }
    header button.home-btn { position:absolute; left:20px; top:50%; transform:translateY(-50%); background:transparent; border:none; color:white; font-weight:700; font-size:1.1rem; display:flex; align-items:center; gap:6px; cursor:pointer; transition:color .3s; }
    header button.home-btn:hover { color:#ffdc00; }
    header button.home-btn svg { width:22px; height:22px; fill:#ffdc00; }
    main { flex:1; display:flex; padding:20px; gap:20px; }
    aside.filters { width:210px; background:white; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); padding:15px 10px; display:flex; flex-direction:column; gap:12px; user-select:none; }
    aside.filters h3 { font-weight:600; margin-bottom:10px; color:#00529b; border-bottom:2px solid #00529b; padding-bottom:5px; }
    aside.filters select { padding:10px; font-size:1rem; border-radius:6px; border:2px solid #00529b; outline:none; cursor:pointer; }
    section.search-area { flex:1; background:white; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.07); padding:20px 25px; display:flex; flex-direction:column; gap:15px; }
    .info-box { font-size:1.1rem; padding:15px; background:#f0f8ff; border-radius:6px; }
    .info-box span { font-weight:600; }
  </style>
</head>
<body>

<header>
  <button class="home-btn" onclick="goHome()" aria-label="الصفحة الرئيسية">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
    </svg>
    الصفحة الرئيسية
  </button>
  التدريبات
</header>

<main>
  <aside class="filters">
    <h3>اختر اللعبة</h3>
    <select id="gameSelect"><option value="">الكل</option></select>

    <h3>اختر الأكاديمية</h3>
    <select id="academySelect" disabled><option value="">الكل</option></select>

    <div id="trainingInfo" class="info-box" style="display:none;">
      <p><span>سعر التدريب: </span><span id="trainingPrice">0</span> جنيه</p>
      <p><span>رقم الكابتن: </span><span id="coachNumber">-</span></p>
      <h3>مواعيد التدريب</h3>
      <div id="trainingSchedule"></div>
    </div>
  </aside>

  <section class="search-area" id="result">
    <!-- يتم هنا عرض "عرض الكل" أو تفاصيل أكاديمية -->
  </section>
</main>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbzcE_1OfbFq5hFr8Vm1KQ_JyyCviT9J6ni1WUzX6VCcbViBGwkK47kDVaILKs41Ayz3cw/exec";
  const gameSelect = document.getElementById("gameSelect");
  const academySelect = document.getElementById("academySelect");
  const trainingInfo = document.getElementById("trainingInfo");
  const trainingPrice = document.getElementById("trainingPrice");
  const coachNumber = document.getElementById("coachNumber");
  const trainingSchedule = document.getElementById("trainingSchedule");
  const resultSection = document.getElementById("result");
  let rawData = [];

  function loadRawData() {
    fetch(`${apiUrl}?action=getRawData`)
      .then(res => res.json())
      .then(data => {
        rawData = data;
        populateGames();
      })
      .catch(err => console.error("خطأ في جلب البيانات الخام:", err));
  }

  function populateGames() {
    const games = Array.from(new Set(rawData.map(r => r["اللعبه"])));
    gameSelect.innerHTML = '<option value="">الكل</option>';
    games.forEach(g => gameSelect.appendChild(new Option(g,g)));
    gameSelect.disabled = games.length === 0;
  }

  gameSelect.addEventListener("change", () => {
    const game = gameSelect.value;
    resultSection.innerHTML = "";
    trainingInfo.style.display = "none";
    academySelect.innerHTML = '<option value="">الكل</option>';
    academySelect.disabled = true;

    if (!game) {
      displayAllGames();
    } else {
      const list = Array.from(new Set(rawData.filter(r => r["اللعبه"]===game).map(r=>r["الاكاديمية"])));
      list.forEach(a=>academySelect.appendChild(new Option(a,a)));
      academySelect.disabled = list.length === 0;
    }
  });

  academySelect.addEventListener("change", () => {
    const game = gameSelect.value;
    const acc = academySelect.value;
    trainingInfo.style.display = "none";
    resultSection.innerHTML = "";

    if (!acc) {
      displayGameSections(game);
    } else {
      displaySingleAcademy(game, acc);
    }
  });

  function displayAllGames() {
    resultSection.innerHTML = '';
    const grouped = {};
    rawData.forEach(r=> { (grouped[r["اللعبه"]] ||= []).push(r); });
    for (const [game, rows] of Object.entries(grouped)) {
      const sec = document.createElement("div"); sec.className="info-box";
      const price = rows[0]["سعر التدريب"];
      const coach = rows[0]["رقم الكابتن"];
      sec.innerHTML = `<h3>${game}</h3><p><span>السعر:</span> ${price} جم</p><p><span>الكابتن:</span> ${coach}</p>`;
      rows.forEach(it=> sec.innerHTML+=`<p>${it["اليوم"]}: من ${it["من"]} - إلى ${it["إلى"]}</p>`);
      resultSection.appendChild(sec);
    }
  }

  function displayGameSections(game) {
    resultSection.innerHTML = '';
    const grouped = {};
    rawData.filter(r=>r["اللعبه"]===game).forEach(r=> { (grouped[r["الاكاديمية"]] ||= []).push(r); });
    for (const [acc, rows] of Object.entries(grouped)) {
      const sec = document.createElement("div"); sec.className="info-box";
      const price = rows[0]["سعر التدريب"];
      const coach = rows[0]["رقم الكابتن"];
      sec.innerHTML = `<h3>${acc}</h3><p><span>السعر:</span> ${price} جم</p><p><span>الكابتن:</span> ${coach}</p>`;
      rows.forEach(it=> sec.innerHTML+=`<p>${it["اليوم"]}: من ${it["من"]} - إلى ${it["إلى"]}</p>`);
      resultSection.appendChild(sec);
    }
  }

  function displaySingleAcademy(game, acc) {
    const rows = rawData.filter(r=> r["اللعبه"]===game && r["الاكاديمية"]===acc);
    if (!rows.length) return;
    trainingPrice.textContent = rows[0]["سعر التدريب"];
    coachNumber.textContent = rows[0]["رقم الكابتن"];
    trainingSchedule.innerHTML = '';
    rows.forEach(it=> trainingSchedule.innerHTML+= `<div>${it["اليوم"]}: من ${it["من"]} - إلى ${it["إلى"]}</div>`);
    trainingInfo.style.display = 'block';
  }

  function goHome(){ window.location.href="home.html"; }
  loadRawData();
</script>

</body>
</html>
