<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>التدريبات</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0; padding: 0;
      background: #f9fafc;
      color: #222;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background-color: #00529b;
      color: white;
      padding: 15px 20px;
      font-size: 1.9rem;
      font-weight: 700;
      text-align: center;
      position: relative;
    }
    main {
      flex: 1;
      display: flex;
      padding: 20px;
      gap: 20px;
    }
    aside.filters {
      width: 250px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
      padding: 15px 10px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      user-select: none;
    }
    aside.filters h3 {
      font-weight: 600;
      margin-bottom: 10px;
      color: #00529b;
      border-bottom: 2px solid #00529b;
      padding-bottom: 5px;
    }
    aside.filters select {
      padding: 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: 2px solid #00529b;
      outline: none;
      cursor: pointer;
    }
    section.result-area {
      flex: 1;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgb(0 0 0 / 0.07);
      padding: 20px 25px;
      overflow-y: auto;
      max-height: 80vh;
    }
    .info-box {
      background: #f0f8ff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 0 8px rgb(0 0 0 / 0.1);
    }
    .info-box h4 {
      margin-top: 0;
      margin-bottom: 8px;
      color: #00529b;
    }
  </style>
</head>
<body>

<header>
  التدريبات
</header>

<main>
  <aside class="filters">
    <h3>اختر اللعبة</h3>
    <select id="gameSelect">
      <option value="الكل">الكل</option>
    </select>

    <h3>اختر الأكاديمية</h3>
    <select id="academySelect" disabled>
      <option value="الكل">الكل</option>
    </select>
  </aside>

  <section class="result-area" id="result">
    <p>اختر اللعبة لعرض التفاصيل.</p>
  </section>
</main>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbzcE_1OfbFq5hFr8Vm1KQ_JyyCviT9J6ni1WUzX6VCcbViBGwkK47kDVaILKs41Ayz3cw/exec";

  const gameSelect = document.getElementById("gameSelect");
  const academySelect = document.getElementById("academySelect");
  const resultArea = document.getElementById("result");

  // تحميل كل البيانات مرة وحدة لتسهيل الفلترة محلياً
  let allData = [];

  function fetchAllData() {
    fetch(apiUrl + "?action=getRawData")
      .then(res => res.json())
      .then(data => {
        allData = data;
        populateGames();
      })
      .catch(err => {
        console.error("خطأ في جلب البيانات:", err);
        resultArea.innerHTML = "<p>حدث خطأ في تحميل البيانات، حاول مرة أخرى.</p>";
      });
  }

  function populateGames() {
    // إزالة الألعاب الحالية (عدا "الكل")
    gameSelect.innerHTML = '<option value="الكل">الكل</option>';

    const uniqueGames = [...new Set(allData.map(item => item["اللعبه"]))];
    uniqueGames.forEach(game => {
      const opt = document.createElement("option");
      opt.value = game;
      opt.textContent = game;
      gameSelect.appendChild(opt);
    });
  }

  gameSelect.addEventListener("change", () => {
    const selectedGame = gameSelect.value;
    academySelect.innerHTML = "";
    resultArea.innerHTML = "";

    if (selectedGame === "الكل") {
      // لما تختار الكل - عرض كل الألعاب مع التفاصيل
      academySelect.disabled = true;
      showAllGames();
    } else {
      // اختيار لعبة محددة - عرض الأكاديميات المرتبطة بها
      academySelect.disabled = false;
      populateAcademies(selectedGame);
      resultArea.innerHTML = "<p>اختر الأكاديمية لعرض التفاصيل.</p>";
    }
  });

  function populateAcademies(game) {
    // جلب الأكاديميات الخاصة باللعبة
    const filtered = allData.filter(item => item["اللعبه"] === game);
    const uniqueAcademies = [...new Set(filtered.map(item => item["الاكاديمية"]))];

    // إضافة خيار "الكل"
    academySelect.innerHTML = '<option value="الكل">الكل</option>';
    uniqueAcademies.forEach(acad => {
      const opt = document.createElement("option");
      opt.value = acad;
      opt.textContent = acad;
      academySelect.appendChild(opt);
    });
  }

  academySelect.addEventListener("change", () => {
    const selectedGame = gameSelect.value;
    const selectedAcademy = academySelect.value;

    if (!selectedAcademy) {
      resultArea.innerHTML = "<p>اختر الأكاديمية لعرض التفاصيل.</p>";
      return;
    }

    if (selectedAcademy === "الكل") {
      // عرض كل الأكاديميات للعبة المختارة
      showAllAcademiesForGame(selectedGame);
    } else {
      // عرض بيانات الأكاديمية المحددة فقط
      showAcademyDetails(selectedGame, selectedAcademy);
    }
  });

  // عرض كل الألعاب مع التفاصيل (لما تختار "الكل" في اللعبة)
  function showAllGames() {
    if (allData.length === 0) {
      resultArea.innerHTML = "<p>لا توجد بيانات للعرض.</p>";
      return;
    }
    let html = "";
    // مجموعة الألعاب الفريدة
    const uniqueGames = [...new Set(allData.map(item => item["اللعبه"]))];

    uniqueGames.forEach(game => {
      html += `<div class="info-box"><h3>اللعبة: ${game}</h3>`;
      const gameItems = allData.filter(item => item["اللعبه"] === game);

      // قائمة الأكاديميات الفريدة مع تفاصيلها
      const uniqueAcademies = [...new Set(gameItems.map(i => i["الاكاديمية"]))];
      uniqueAcademies.forEach(acad => {
        const acadItems = gameItems.filter(i => i["الاكاديمية"] === acad);
        const first = acadItems[0];
        html += `
          <div style="margin-bottom:10px; padding:10px; border:1px solid #ddd; border-radius:5px;">
            <h4>الأكاديمية: ${acad}</h4>
            <p><strong>سعر التدريب:</strong> ${first["سعر التدريب"]} جنيه</p>
            <p><strong>رقم الكابتن:</strong> ${first["رقم الكابتن"]}</p>
            <p><strong>المواعيد:</strong></p>
            <ul>
              ${acadItems.map(i => `<li>${i["اليوم"]}: من ${i["من"]} إلى ${i["الي"]}</li>`).join("")}
            </ul>
          </div>
        `;
      });
      html += "</div>";
    });
    resultArea.innerHTML = html;
  }

  // عرض كل الأكاديميات للعبة مختارة (لما تختار "الكل" في الأكاديمية)
  function showAllAcademiesForGame(game) {
    const filtered = allData.filter(item => item["اللعبه"] === game);
    if (filtered.length === 0) {
      resultArea.innerHTML = "<p>لا توجد بيانات لهذه اللعبة.</p>";
      return;
    }
    let html = `<h3>جميع الأكاديميات للعبة ${game}:</h3>`;
    const uniqueAcademies = [...new Set(filtered.map(i => i["الاكاديمية"]))];
    uniqueAcademies.forEach(acad => {
      const acadItems = filtered.filter(i => i["الاكاديمية"] === acad);
      const first = acadItems[0];
      html += `
        <div class="info-box">
          <h4>الأكاديمية: ${acad}</h4>
          <p><strong>سعر التدريب:</strong> ${first["سعر التدريب"]} جنيه</p>
          <p><strong>رقم الكابتن:</strong> ${first["رقم الكابتن"]}</p>
          <p><strong>المواعيد:</strong></p>
          <ul>
            ${acadItems.map(i => `<li>${i["اليوم"]}: من ${i["من"]} إلى ${i["الي"]}</li>`).join("")}
          </ul>
        </div>
      `;
    });
    resultArea.innerHTML = html;
  }

  // عرض تفاصيل أكاديمية محددة للعبة محددة
  function showAcademyDetails(game, academy) {
    const filtered = allData.filter(item => item["اللعبه"] === game && item["الاكاديمية"] === academy);
    if (filtered.length === 0) {
      resultArea.innerHTML = "<p>لا توجد بيانات لهذه الأكاديمية.</p>";
      return;
    }
    const first = filtered[0];
    let html = `
      <div class="info-box">
        <h3>اللعبة: ${game}</h3>
        <h4>الأكاديمية: ${academy}</h4>
        <p><strong>سعر التدريب:</strong> ${first["سعر التدريب"]} جنيه</p>
        <p><strong>رقم الكابتن:</strong> ${first["رقم الكابتن"]}</p>
        <p><strong>المواعيد:</strong></p>
        <ul>
          ${filtered.map(i => `<li>${i["اليوم"]}: من ${i["من"]} إلى ${i["الي"]}</li>`).join("")}
        </ul>
      </div>
    `;
    resultArea.innerHTML = html;
  }

  // بداية تحميل البيانات عند فتح الصفحة
  fetchAllData();

</script>

</body>
</html>
