<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>التدريبات</title>
  <style>
    /* ... CSS زي ما هو ... */
  </style>
</head>
<body>

<main>
  <aside class="filters">
    <h3>اختر اللعبة</h3>
    <select id="gameSelect"><option value="">-- اختر لعبة --</option></select>

    <h3>اختر الأكاديمية</h3>
    <select id="academySelect" disabled><option value="">-- اختر أكاديمية --</option></select>

    <div id="trainingInfo" class="info-box" style="display:none;">
      <p><span>سعر التدريب:</span> <span id="trainingPrice">0</span> جنيه</p>
      <p><span>رقم الكابتن:</span> <span id="coachNumber">-</span></p>
      <h3>مواعيد التدريب</h3>
      <div id="trainingSchedule"></div>
    </div>
  </aside>
</main>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbzcE_1OfbFq5hFr8Vm1KQ_JyyCviT9J6ni1WUzX6VCcbViBGwkK47kDVaILKs41Ayz3cw/exec";

  const gameSelect = document.getElementById("gameSelect");
  const academySelect = document.getElementById("academySelect");
  const trainingInfo = document.getElementById("trainingInfo");
  const trainingPrice = document.getElementById("trainingPrice");
  const coachNumber = document.getElementById("coachNumber");
  const trainingSchedule = document.getElementById("trainingSchedule");

  // دالة loadGames
  function loadGames() {
    console.log("🔍 جلب الألعاب...");
    fetch(`${apiUrl}?action=getGames`)
      .then(res => res.json())
      .then(data => {
        console.log("📥 بيانات getGames:", data);
        const games = data.games || [];
        gameSelect.innerHTML = '<option value="">-- اختر لعبة --</option>';
        games.forEach(g => {
          const opt = new Option(g, g);
          gameSelect.add(opt);
        });
        gameSelect.disabled = false;
      })
      .catch(e => console.error("❌ خطأ جلب الألعاب:", e));
  }

  // دالة loadAcademies
  function loadAcademies(game) {
    console.log("🔍 جلب الأكاديميات لـ:", game);
    fetch(`${apiUrl}?action=getAcademies&game=${encodeURIComponent(game)}`)
      .then(res => res.json())
      .then(data => {
        console.log("📥 بيانات getAcademies:", data);
        const acc = data.academies || [];
        academySelect.innerHTML = '<option value="">-- اختر أكاديمية --</option>';
        acc.forEach(a => {
          const opt = new Option(a, a);
          academySelect.add(opt);
        });
        academySelect.disabled = !acc.length;
      })
      .catch(e => console.error("❌ خطأ جلب الأكاديميات:", e));
  }

  // دالة loadTrainingDetails
  function loadTrainingDetails(academy) {
    const game = gameSelect.value;
    console.log("🔍 جلب التفاصيل:", game, academy);
    fetch(`${apiUrl}?action=getTrainingDetails&game=${encodeURIComponent(game)}&academy=${encodeURIComponent(academy)}`)
      .then(res => res.json())
      .then(data => {
        console.log("📥 بيانات getTrainingDetails:", data);
        if (data.schedule && data.schedule.length) {
          trainingPrice.textContent = data.price || 'غير متوفر';
          coachNumber.textContent = data.coach || '-';
          trainingSchedule.innerHTML = '';
          data.schedule.forEach(item => {
            const div = document.createElement('div');
            div.textContent = `${item.اليوم}: من ${item.من} إلى ${item.إلى}`;
            trainingSchedule.appendChild(div);
          });
          trainingInfo.style.display = 'block';
        } else {
          trainingInfo.style.display = 'none';
        }
      })
      .catch(e => {
        console.error("❌ خطأ جلب تفاصيل التدريب:", e);
        trainingInfo.style.display = 'none';
      });
  }

  // أحداث اختيار
  gameSelect.addEventListener('change', () => {
    if (gameSelect.value) loadAcademies(gameSelect.value);
    trainingInfo.style.display = 'none';
  });
  academySelect.addEventListener('change', () => {
    if (academySelect.value) loadTrainingDetails(academySelect.value);
  });

  // تشغيل أولي
  loadGames();
</script>

</body>
</html>
