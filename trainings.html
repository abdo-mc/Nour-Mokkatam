<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª</title>
  <style>
    /* ... CSS Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... */
  </style>
</head>
<body>

<main>
  <aside class="filters">
    <h3>Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
    <select id="gameSelect"><option value="">-- Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø© --</option></select>

    <h3>Ø§Ø®ØªØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</h3>
    <select id="academySelect" disabled><option value="">-- Ø§Ø®ØªØ± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© --</option></select>

    <div id="trainingInfo" class="info-box" style="display:none;">
      <p><span>Ø³Ø¹Ø± Ø§Ù„ØªØ¯Ø±ÙŠØ¨:</span> <span id="trainingPrice">0</span> Ø¬Ù†ÙŠÙ‡</p>
      <p><span>Ø±Ù‚Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ†:</span> <span id="coachNumber">-</span></p>
      <h3>Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</h3>
      <div id="trainingSchedule"></div>
    </div>
  </aside>
</main>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbzcE_1OfbFq5hFr8Vm1KQ_JyyCviT9J6ni1WUzX6VCcbViBGwkK47kDVaILKs41Ayz3cw/exec";

  const gameSelect = document.getElementById("gameSelect");
  const academySelect = document.getElementById("academySelect");
  const trainingInfo = document.getElementById("trainingInfo");
  const trainingPrice = document.getElementById("trainingPrice");
  const coachNumber = document.getElementById("coachNumber");
  const trainingSchedule = document.getElementById("trainingSchedule");

  // Ø¯Ø§Ù„Ø© loadGames
  function loadGames() {
    console.log("ðŸ” Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨...");
    fetch(`${apiUrl}?action=getGames`)
      .then(res => res.json())
      .then(data => {
        console.log("ðŸ“¥ Ø¨ÙŠØ§Ù†Ø§Øª getGames:", data);
        const games = data.games || [];
        gameSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø© --</option>';
        games.forEach(g => {
          const opt = new Option(g, g);
          gameSelect.add(opt);
        });
        gameSelect.disabled = false;
      })
      .catch(e => console.error("âŒ Ø®Ø·Ø£ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨:", e));
  }

  // Ø¯Ø§Ù„Ø© loadAcademies
  function loadAcademies(game) {
    console.log("ðŸ” Ø¬Ù„Ø¨ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ§Øª Ù„Ù€:", game);
    fetch(`${apiUrl}?action=getAcademies&game=${encodeURIComponent(game)}`)
      .then(res => res.json())
      .then(data => {
        console.log("ðŸ“¥ Ø¨ÙŠØ§Ù†Ø§Øª getAcademies:", data);
        const acc = data.academies || [];
        academySelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© --</option>';
        acc.forEach(a => {
          const opt = new Option(a, a);
          academySelect.add(opt);
        });
        academySelect.disabled = !acc.length;
      })
      .catch(e => console.error("âŒ Ø®Ø·Ø£ Ø¬Ù„Ø¨ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ§Øª:", e));
  }

  // Ø¯Ø§Ù„Ø© loadTrainingDetails
  function loadTrainingDetails(academy) {
    const game = gameSelect.value;
    console.log("ðŸ” Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„:", game, academy);
    fetch(`${apiUrl}?action=getTrainingDetails&game=${encodeURIComponent(game)}&academy=${encodeURIComponent(academy)}`)
      .then(res => res.json())
      .then(data => {
        console.log("ðŸ“¥ Ø¨ÙŠØ§Ù†Ø§Øª getTrainingDetails:", data);
        if (data.schedule && data.schedule.length) {
          trainingPrice.textContent = data.price || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          coachNumber.textContent = data.coach || '-';
          trainingSchedule.innerHTML = '';
          data.schedule.forEach(item => {
            const div = document.createElement('div');
            div.textContent = `${item.Ø§Ù„ÙŠÙˆÙ…}: Ù…Ù† ${item.Ù…Ù†} Ø¥Ù„Ù‰ ${item.Ø¥Ù„Ù‰}`;
            trainingSchedule.appendChild(div);
          });
          trainingInfo.style.display = 'block';
        } else {
          trainingInfo.style.display = 'none';
        }
      })
      .catch(e => {
        console.error("âŒ Ø®Ø·Ø£ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨:", e);
        trainingInfo.style.display = 'none';
      });
  }

  // Ø£Ø­Ø¯Ø§Ø« Ø§Ø®ØªÙŠØ§Ø±
  gameSelect.addEventListener('change', () => {
    if (gameSelect.value) loadAcademies(gameSelect.value);
    trainingInfo.style.display = 'none';
  });
  academySelect.addEventListener('change', () => {
    if (academySelect.value) loadTrainingDetails(academySelect.value);
  });

  // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
  loadGames();
</script>

</body>
</html>
