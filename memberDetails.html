<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
    body {
      font-family: 'Cairo', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #004080;
      text-align: center;
      margin-bottom: 10px;
    }
    .user-info {
      text-align: center;
      color: #555;
      margin-bottom: 30px;
      font-size: 1rem;
    }
    .member-info {
      max-width: 450px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      text-align: center;
      transition: all 0.3s ease;
    }
    .member-info img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 20px;
      border: 3px solid #004080;
    }
    .member-info table {
      width: 100%;
      text-align: right;
      font-size: 1.1rem;
      border-collapse: collapse;
    }
    .member-info th,
    .member-info td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    .member-info th {
      color: #004080;
      font-weight: 700;
      width: 40%;
    }
    .status {
      font-weight: bold;
      padding: 10px;
      margin-top: 15px;
      border-radius: 6px;
      display: inline-block;
    }
    .active {
      color: #155724;
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
    }
    .inactive {
      color: #721c24;
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
    }
    .error {
      color: red;
      font-weight: bold;
      text-align: center;
      padding: 20px;
    }
    .back-link,
    .print-btn {
      display: inline-block;
      margin-top: 30px;
      margin-inline: 10px;
      text-align: center;
      font-weight: 700;
      color: #fff;
      text-decoration: none;
      background-color: #004080;
      padding: 10px 20px;
      border-radius: 8px;
      transition: background-color 0.3s;
    }
    .back-link:hover,
    .print-btn:hover {
      background-color: #0066cc;
    }

    /* Spinner */
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #004080;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 30px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 500px) {
      .member-info {
        width: 90%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

<h1>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ</h1>
<div class="user-info" id="userInfo">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©...</div>
<div class="member-info" id="memberInfo">
  <div class="spinner"></div>
</div>

<div style="text-align:center;">
  <a href="membership.html" class="back-link">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ§Øª</a>
  <a href="#" onclick="window.print()" class="print-btn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
</div>

<script>
  const username = localStorage.getItem('username');
  const name = localStorage.getItem('name');
  const userInfo = document.getElementById('userInfo');
  const memberDiv = document.getElementById('memberInfo');

  if (!username) {
    window.location.href = 'login.html';
  } else {
    userInfo.textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${name}`;
  }

  function getQueryParam(param) {
    return new URLSearchParams(window.location.search).get(param);
  }

  const memberId = getQueryParam('id');
  if (!memberId) {
    memberDiv.innerHTML = `<div class="error">Ù„Ù… ÙŠØªÙ… ØªÙ…Ø±ÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.</div>`;
  } else {
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzEjXCNkR1dv7DGfaiaYdFMmMYXGIpLAZVLjGAJD-7lSTeEUe8cSSfnonnWvOUjExc5HA/exec';

    fetch(`${apiUrl}?action=getMember&id=${encodeURIComponent(memberId)}`)
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          memberDiv.innerHTML = `<div class="error">âŒ ${data.error}</div>`;
          return;
        }

        const isRenewed = data["Ø§Ù„ØªØ¬Ø¯ÙŠØ¯"]?.trim() === "Ù…Ø¬Ø¯Ø¯";
        const statusClass = isRenewed ? "active" : "inactive";
        const statusText = isRenewed ? "Ø¹Ø¶Ùˆ Ù†Ø´Ø· (Ù…Ø¬Ø¯Ø¯)" : "Ø¹Ø¶Ùˆ ØºÙŠØ± Ù†Ø´Ø· (ØºÙŠØ± Ù…Ø¬Ø¯Ø¯)";

        memberDiv.innerHTML = `
          <img src="${data["ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø¶Ùˆ"] || 'https://via.placeholder.com/120'}" alt="ØµÙˆØ±Ø© ${data["Ø§Ù„Ø§Ø³Ù…"] || 'Ø¹Ø¶Ùˆ'}" />
          <table>
            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©:</th><td>${data["Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©"] || '-'}</td></tr>
            <tr><th>Ø§Ù„Ø§Ø³Ù…:</th><td>${data["Ø§Ù„Ø§Ø³Ù…"] || '-'}</td></tr>
            <tr><th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©:</th><td>${data["Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©"] || '-'}</td></tr>
            <tr><th>Ø§Ù„Ù†ÙˆØ¹:</th><td>${data["Ø§Ù„Ù†ÙˆØ¹"] || '-'}</td></tr>
            <tr><th>Ø§Ù„ØªØ¬Ø¯ÙŠØ¯:</th><td>${data["Ø§Ù„ØªØ¬Ø¯ÙŠØ¯"] || '-'}</td></tr>
            <tr><th>Ø­Ù‚ Ø­Ø¶ÙˆØ± Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©:</th><td>${data["Ø­Ù‚ Ø­Ø¶ÙˆØ± Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©"] || '-'}</td></tr>
          </table>
          <div class="status ${statusClass}">${statusText}</div>
        `;
      })
      .catch(() => {
        memberDiv.innerHTML = `<div class="error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„.</div>`;
      });
  }
</script>

</body>
</html>
