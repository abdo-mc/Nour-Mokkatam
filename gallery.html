<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“· Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± | Ù†ÙˆØ± Ø§Ù„Ù…Ù‚Ø·Ù…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.0/css/lightgallery.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; margin:0; padding:20px; background:#f5f7f8; color:#222; }
    .btn-back { background:#00bfa5; color:#fff; padding:8px 16px; border:none; border-radius:5px; cursor:pointer; margin-bottom:20px; }
    .album { margin-bottom:50px; }
    .album-header { display:flex; justify-content: space-between; align-items:center; margin-bottom:10px; }
    .album-header h2 { margin:0; border-right:5px solid #00bfa5; padding-right:10px; }
    .gallery { column-count: auto; column-width: 200px; column-gap:12px; }
    .item { position: relative; margin-bottom:12px; break-inside: avoid; cursor: pointer; }
    .item img { width:100%; border-radius:10px; transition: transform .3s; display: block; }
    .item:hover img { transform:scale(1.05); }
    .map { width:100%; height:200px; margin-bottom:30px; background:#e0e0e0; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#666; }
  </style>
</head>
<body>

<button class="btn-back" onclick="location.href='index.html'">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<div id="gallery-container"></div>

<template id="album-template">
  <div class="album">
    <div class="album-header">
      <h2></h2>
    </div>
    <div class="gallery"></div>
  </div>
</template>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.0/lightgallery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.0/plugins/thumbnail/lg-thumbnail.min.js"></script>
<script>
const API = 'https://script.google.com/macros/s/AKfycbzno9JeoaH3aL8TeoSmx0adr1cbgoLVWKBq82MhSn-S_k70z69rpHJL31oCFKZYcn2B/exec';
async function load() {
  const res = await fetch(API);
  const { albums } = await res.json();

  const container = document.getElementById('gallery-container');
  const observer = lozad('.lozad', { rootMargin: '200px 0px' });

  albums.forEach(album => {
    const tmpl = document.getElementById('album-template').content.cloneNode(true);
    tmpl.querySelector('h2').textContent = album.name;
    const gal = tmpl.querySelector('.gallery');

    // Add placeholder for map (issue 3)
    const mapDiv = document.createElement('div'); mapDiv.className = 'map';
    mapDiv.textContent = 'ðŸ” Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‡Ù†Ø§';
    tmpl.querySelector('.album').prepend(mapDiv);

    album.pics.forEach(pic => {
      const div = document.createElement('div'); div.className = 'item';
      const img = document.createElement('img');
      img.setAttribute('data-src', pic.thumbnail);
      img.className = 'lozad';
      img.alt = pic.filename;
      div.appendChild(img);
      div.addEventListener('click', () => {
        lg.openGalleryLightbox(div);
      });
      gal.appendChild(div);
    });

    container.appendChild(tmpl);
  });

  observer.observe();

  // initialize lightGallery
  const lg = lightGallery(document.body, {
    selector: '.item',
    plugins: [lgThumbnail],
    download: false,
    getCaptionFromTitleOrAlt: false,
    dynamic: true,
    dynamicEl: albums.flatMap(a => a.pics.map(p => ({
      src: p.url, thumb: p.thumbnail, subHtml: `<h4>${p.filename}</h4>`
    })))
  });
}

load();
</script>
</body>
</html>
